\chapter{FROG report format}
\label{chap:spec}

A FROG report contains information about one model present in one file.
The report consists of several files that must be saved in a single directory structure, such as in a single folder or in a single subdirectory of an archive file (see \cref{sec:archives}).
Independently of the storage method, the report files should be extractable into a single filesystem-level directory to allow easy data access for various tools.

\section{Archive files with FROG reports}
\label{sec:archives}

FROG reports may be stored and distributed in archives of formats such as ZIP (with extension \texttt{.zip}) or tarballs (with extensions \texttt{.tar.gz} or \texttt{.tar.bz2}).
Tool authors should ensure that the suitable compression method is available on as many platforms as possible. Using ZIP archives is recommended.

The archive file must contain the report files in the top-level directory (i.e., no subdirectories should be used).

As a special case, the files may be stored in the OMEX format.
\todo{Can someone who knows OMEX fill in this section?}

\section{Directory layout}
\label{sec:files}

The required files that must be present in a FROG report are listed in \cref{tab:files}. Formatting and contents of the files are described in the following sections (also referenced from the table).

\begin{table}[p]\tablefont
\begin{tabular}{lp{.3\linewidth}ll}
\toprule
File name & Contents & Format & Description \\
\midrule
\texttt{00\_metadata.json}
 & Basic information about the model file, information about the FROG report software.
 & JSON (\cref{sec:json})
 & \cref{sec:meta}
 \\\addlinespace
\texttt{01\_objective.json}
 & Expected optimal objective values.
 & TSV (\cref{sec:tsv})
 & \cref{sec:obj}
 \\\addlinespace
\texttt{02\_fva.json}
 & Expected reaction flux variability at the model optima.
 & TSV (\cref{sec:tsv})
 & \cref{sec:fva}
 \\\addlinespace
\texttt{03\_gene\_deletion.json}
 & Expected behavior of the model under single-gene deletions.
 & TSV (\cref{sec:tsv})
 & \cref{sec:genes}
 \\\addlinespace
\texttt{04\_reaction\_deletion.json}
 & Expected behavior of the model under single-reaction deletions.
 & TSV (\cref{sec:tsv})
 & \cref{sec:rxns} \\
\bottomrule
\end{tabular}
\caption{Files required in a FROG report.}
\label{tab:files}
\end{table}

\section{Report file formats}

This section describes the encoding of information into file contents used by FROG reports.

\subsection{JSON}
\label{sec:json}

JSON-formatted FROG report files must adhere to the JSON formatting as specified by RFC~8259~\cite{rfc8259}.
The character encoding of the JSON-formatted file must be UTF-8 (see \cite[][section 8.1]{rfc8259}).

Individual files may require adherence to a specified JSON schema, which shall be provided in JSONS format in the respective section that describe the files' contents.

\subsection{TSV}
\label{sec:tsv}

TSV stands for Tab-Separated Values file. The format is defined as a matrix of text fields that do not contain characters for a tab and a newline (character values 9 and 10 respectively, commonly written as \verb|\t| and \verb|\n|), where the tab is used to separate individual per-column values in each row, and the newline is used to separate individual rows.

All fields in a FROG TSV file must be encoded in UTF-8 and must not contain tab or newline characters. The first row of each FROG TSV file (a \emph{header row}) must contain column names as prescribed in the appropriate specification section. The columns must be present in the order prescribed by the specification. All other rows except for the header row are called \emph{entry rows}.

The format is additionally described by IANA as media type `tab-separated-values'~\cite{ianatsv}.

As an example, the TSV file in~\cref{lst:ecoli-obj} contains one header row and one entry row, and te entry row contains (in order) 2 plain text values, 1 objective status value, and 1 numeric value. For clarity, the listing highlights the tab characters with light gray.

\subsubsection{Numeric and special values in TSV files}
\emph{Numeric} fields must be converted to decimal representation. The decimal representation may include a leading minus sign, decimal point, and an integer exponent separated by \verb|e| (for example, valid encodings of $-1234.5\times10^2$ include \verb|-123450| and \verb|-12.345e4|). Rounding of non-representable and infinite numbers is allowed as long as it does not invalidate the stored information with respect to the report comparison methodology, as described in~\cref{sec:cmpdata}.

Missing numeric values must be represented by an empty string. Missing values typically occur when a value is expected in a field (such as in a place of optimal value of the model) but it can not be computed for some reason (such as model infeasibility).

\emph{Solver status} fields contain a special value that describes outcome of an optimization algorithm. FROG currently describes only 2 kinds of statuses:
\begin{itemize}
\item a feasible solution was found and the returned result is optimal, represented by keyword \verb|optimal|,
\item a feasible solution was not found, represented by keyword \verb|infeasible|.
\end{itemize}
Solver status fields must contain exactly one of the above keywords.

\section{Report file contents}

\subsection{Metadata file}
\label{sec:meta}

The contents of the metadata file is formatted as JSON that contains a single JSON object. The main purposes of the file include:
\begin{itemize}
\item identifying the model file being described,
\item describing the software that was used to generate the report.
\end{itemize}

The expected properties and sub-properties of the JSON object are listed in \cref{tab:metafields}. The fields labeled as `required' must be present in a FROG report. The fields labeled as `optional' may be present, but the software should implement generation and testing of these fields.

The JSON structure must adhere to the schema published at \todo{put the schema online, make repo links work}.

\begin{table}[p]\tablefont
\begin{tabular}{lp{30em}l}
\toprule
Field & Description & Presence \\
\midrule
\verb|model.filename|
 & expected basename of the model file, such as \verb|e_coli_core.xml|
 & required
 \\
\verb|model.md5|
 & 32-hexadecimal-digit MD5 hash~\cite{rfc1321} of the model file contents
 & required
 \\
\verb|model.sha256|
 & 64-hexadecimal-digit SHA256 hash~\cite{national2008secure} of the model file contents
 & optional
 \\
\verb|environment|
 & free-text description of the software environment, such as from \verb|uname -a|
 & required
 \\
\verb|software.name|
 & name of the FROG report generator software
 & required
 \\
\verb|software.version|
 & version of the software
 & required
 \\
\verb|software.url|
 & URL of the software homepage
 & optional
 \\
\verb|solver.name|
 & name of the solver used to compute the reported values
 & required
 \\
\verb|solver.version|
 & version of the solver
 & required
 \\
\verb|solver.url|
 & URL of the solver homepage
 & optional
 \\
\bottomrule
\end{tabular}
\caption[Contents of the FROG metadata file.]{Contents of the FROG metadata file. Names that contain a dot (\texttt{.}) represent properties of nested objects in the usual JavaScript object property access notation.}
\label{tab:metafields}
\end{table}

\subsection{Objective value report file}
\label{sec:obj}

For each objective that is described by the model file, the objective value report contains a single entry row that describes the optimal objective value found by the flux balance analysis algorithm. The required columns and the format and semantics of the entries is specified in~\cref{tab:objfields}.

\todo{write down the math here?}

\todo{explicitly point out the fact that SBML may have multiple objectives}

\begin{table}[p]\tablefont
\begin{tabular}{llp{30em}}
\toprule
Column & Format & Value \\
\midrule
\verb|model|
 & text
 & basename of the file, matching \verb|model.filename| in the metadata file
 \\
\verb|objective|
 & text
 & identifier of the objective
 \\
\verb|status|
 & solver status
 & termination status of the flux balance analysis solver run
 \\
\verb|value|
 & numeric
 & optimal objective value
 \\
\bottomrule
\end{tabular}
\caption{Columns present in FROG objective value report file.}
\label{tab:objfields}
\end{table}

\subsection{Flux variability report file}
\label{sec:fva}
For each objective that is described by the model file and for each reaction, the flux variability report contains an entry that describes minimal, maximal, and reference flux value through the given reaction at optimal flux objective. The required columns and the format and semantics of the entries is specified in~\cref{tab:fvafields}. The values of minima and maxima should be generated by a flux variability analysis function. The reference flux should be generated by a flux balance analysis; its value is thus only informative because the solution is typically not unique.

\todo{math for FVA?}

\todo{Since there are 2 optimizer runs for each row, why don't we have 2 solver statuses?}

\todo{rename flux to reference\_flux?}

\begin{table}[p]\tablefont
\begin{tabular}{llp{30em}}
\toprule
Column & Format & Value \\
\midrule
\verb|model|
 & text
 & basename of the file, matching \verb|model.filename| in the metadata file
 \\
\verb|objective|
 & text
 & identifier of the objective that is optimized
 \\
\verb|reaction|
 & text
 & identifier of the reaction
 \\
\verb|flux|
 & numeric
 & the reference flux through the reaction in some computed optimal solution
 \\
\verb|status|
 & solver status
 & termination status of the flux variability analysis solver run for the reaction
 \\
\verb|minimum|
 & numeric
 & minimal flux through the reaction with optimal objective
 \\
\verb|maximum|
 & numeric
 & maximal flux through the reaction with optimal objective
 \\
\verb|fraction_optimum|
 & numeric
 & fragment of objective value that must be retained by flux variability analysis (must be \verb|1.0|)
 \\
\bottomrule
\end{tabular}
\caption{Columns present in FROG flux variability report file.}
\label{tab:fvafields}
\end{table}

\subsection{Gene deletion report file}
\label{sec:genes}

For each objective that is described by the model file and for each reaction, the gene deletion report contains an entry that describes the achievable objective value if the given gene is knocked out (i.e., all reactions that depend on the gene to carry flux are either deleted or constrained to zero flux). The required columns and the format and semantics of the entries is specified in~\cref{tab:genefields}.

The gene deletion algorithm must be compatible with the single gene knockout procedure described in~\cref{sec:algos}.

\begin{table}[p]\tablefont
\begin{tabular}{llp{30em}}
\toprule
Column & Format & Value \\
\midrule
\verb|model|
 & text
 & basename of the file, matching \verb|model.filename| in the metadata file
 \\
\verb|objective|
 & text
 & identifier of the objective that is optimized
 \\
\verb|gene|
 & text
 & identifier of the gene to be knocked out
 \\
\verb|status|
 & solver status
 & termination status of the corresponding solver run
 \\
\verb|value|
 & numeric
 & optimal objective value when the gene is knocked out
 \\
\bottomrule
\end{tabular}
\caption{Columns present in FROG gene deletion report file.}
\label{tab:genefields}
\end{table}

\subsection{Reaction deletion report file}
\label{sec:rxns}

For each objective that is described by the model file and for each reaction, the reaction deletion report contains an entry that describes the achievable objective value if the given reaction can not be used (e.g., it is deleted from the model, or it is constrained to be zero). The required columns and the format and semantics of the entries is specified in~\cref{tab:rxnsfields}.

\todo{math?}
\begin{table}[p]\tablefont
\begin{tabular}{llp{30em}}
\toprule
Column & Format & Value \\
\midrule
\verb|model|
 & text
 & basename of the file, matching \verb|model.filename| in the metadata file
 \\
\verb|objective|
 & text
 & identifier of the objective that is optimized
 \\
\verb|reaction|
 & text
 & identifier of the reaction to be deleted
 \\
\verb|status|
 & solver status
 & termination status of the corresponding solver run
 \\
\verb|value|
 & numeric
 & optimal objective value when the reaction is deleted from the model
 \\
\bottomrule
\end{tabular}
\caption{Columns present in FROG reaction deletion report file.}
\label{tab:rxnsfields}
\end{table}
